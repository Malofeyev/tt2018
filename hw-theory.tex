\documentclass[10pt,a4paper,oneside]{article}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{enumerate}
\usepackage{stmaryrd}
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm,bindingoffset=0cm]{geometry}
\usepackage{proof}
\usepackage{url}
\newcommand{\gq}[1]{\texttt{<<}#1\texttt{>>}}
\newcommand{\ogq}[1]{\overline{\texttt{<<}#1\texttt{>>}}}
\begin{document}

\begin{center}{\Large\textsc{\textbf{Теоретические (``малые'') домашние задания}}}\\
             \it Теория типов, ИТМО, М3334-М3339, осень 2018 года\end{center}

\section*{Домашнее задание №1: <<знакомство с лямбда-исчислением>>}

\begin{enumerate}
\item Расставьте скобки:

$\lambda f.\lambda x.f\ x\ \ (\lambda c.g\ f)\ x\ a\ \lambda b.\lambda a.x$

\item Проведите бета-редукции и приведите выражения к нормальной форме:

\begin{enumerate}
\item $(\lambda f.\lambda x.f\ (f\ x))\ (\lambda f.\lambda x.f\ (f\ x))$
\item $(\lambda a.\lambda b.b)\ ((\lambda x.x\ x)\ (\lambda x.x\ x\ x))$
\end{enumerate}

\item Выразите следующие функции в лямбда-исчислении:

\begin{enumerate}
\item Or, Xor
\item isZero (T, если аргумент равен 0, иначе F)
\item isEven (T, если аргумент чётный)
\item умножение на 2, умножение
\item возведение в степень
\item вычитание 1, вычитание
\end{enumerate}
\end{enumerate}

\section*{Домашнее задание №2: <<пропущенные теоремы лямбда-исчисления>>}

Докажите следующие леммы, упомянутые, но недоказанные на лекции:

\begin{enumerate}
\item Если отношение $R$ обладает ромбовидным свойством, то и отношение $R^*$ 
(транзитивное и рефлексивное замыкание $R$) также им обладает.
\item Отношение альфа-эквивалентности является отношением эквивалентности.
\item Если $P_1\rightrightarrows_\beta P_2$ и $Q_1\rightrightarrows_\beta Q_2$, то $P_1[x := Q_1] \rightrightarrows_\beta P_2[x := Q_2]$.
\item $(\rightrightarrows_\beta)$ обладает ромбовидным свойством.
\item $(\rightrightarrows_\beta) \subseteq (\rightarrow_\beta)^*$ 
\item $(\rightarrow_\beta) \subseteq (\rightrightarrows_\beta)$ 
\end{enumerate}

\section*{Домашнее задание №3: <<просто типизированное лямбда-исчисление>>}

\begin{enumerate}
\item Докажите лемму о промежуточных типах (Generation lemma, 3.1.6 из 
Morten Heine B. Sørensen, Pawel Urzyczyn: Lections on the Curry-Howard Isomorphism). 
А именно, покажите, что:
  \begin{enumerate}
  \item $\Gamma \vdash x : \tau$ влечёт $x : \tau \in \Gamma$.
  \item $\Gamma \vdash M N : \sigma$ влечёт существование типа $\tau$, такого, что
    что $\Gamma \vdash M : \tau\rightarrow\sigma$ и $\Gamma \vdash N : \tau$.
  \item $\Gamma \vdash \lambda x.M : \sigma$ влечёт существование типов $\tau$ и $\rho$, таких, что
    $\Gamma, x: \tau \vdash M : \rho$ и $\sigma = \tau\rightarrow\rho$
  \end{enumerate}

\item Докажите лемму о подстановке (Substitution lemma, 3.1.8):
\begin{enumerate}
   \item Обозначим за $\sigma[\alpha:=\tau]$ (за $\Gamma[\alpha:=\tau]$) замену всех элементарных 
   типов $\alpha$ на тип $\tau$ в типе $\sigma$ (во всех типах в $\Gamma$). 
   Тогда, если $\Gamma \vdash M : \sigma$, то $\Gamma[\alpha := \tau] \vdash M : \sigma [\alpha := \tau]$.
   \item Если $\Gamma, x:\tau \vdash M : \sigma$ и $\Gamma \vdash N : \tau$, то $\Gamma \vdash M[x := N]:\sigma$.
\end{enumerate}

\item Докажите лемму о редукции терма (Subject reduction proposition, 3.1.9):
    если $\Gamma\vdash M:\sigma$ и $M \rightarrow_\beta N$, то $\Gamma \vdash N:\sigma$.

\item Пользуясь предыдущими пунктами, покажите, что $Y$ нетипизируем в просто типизированном лямбда-исчислении.

\item Найдите терм $M$ и два различных типа $\sigma$ и $\tau$, что $\vdash M: \sigma$ и $\vdash M:\tau$.
    А существует ли терм $M$, имеющий в точности один тип?

\item Покажите, что лемма о редукции терма не работает <<в обратную сторону>>. А именно, что:
   \begin{enumerate}
   \item Найдутся $M$, $N$ и $\tau$, что $\vdash N:\tau$, $M \rightarrow_\beta N$, но $M$ не имеет типа.
   \item Найдутся $M$, $N$, $\sigma$ и $\tau$, что $\vdash M:\sigma$, $\vdash N:\tau$ и $M \rightarrow_\beta N$, но
     $\nvdash M:\tau$.
   \end{enumerate}
\end{enumerate}

\section*{Домашнее задание №4: <<просто типизированное лямбда-исчисление; алгебраические типы>>}

\begin{enumerate}
\item Списки и алгебраические типы.
  В данном задании потребуется строить и преобразовывать довольно сложные лямбда-выражения.
  Для проверки рекомендуем пользоваться интерпретатором, например, можно взять \verb!LCI!:
  \url{https://chatziko.github.io/lci/}. Возможно, для демонстрации домашнего задания
  вам потребуется использовать свой ноутбук и проектор.

  \begin{enumerate}
  \item Определите алгебраический тип для списка целых чисел в вашем любимом языке программирования.
        На Окамле это будет \verb!type int_list = Nil | Cons of (int * int_list)!. Вы можете использовать
        и не функциональный язык (C++, Kotlin и т.п.), но вы должны применять именно алгебраический тип
        или его аналог (то есть, \verb!union! в C++, \verb!sealed class! в Kotlin и т.п.).
  \item Напишите функции вычисления длины списка, подсчёта суммы списка, произведения списка.
  \item Определите функцию высшего порядка \verb!map! (применяющую переданную параметром функцию 
        к каждому элементу списка), и примените её для построения списка нулей 
        (превратить список чисел в список нулей той же длины), удвоенных значений
        (превратить список $[1,3,5]$ в $[2,6,10]$), списка остатков от деления на 2 ($[2,3,5]$ в $[0,1,1]$).
  \item Перепишите весь код из предыдущих пунктов в чистых лямбда-выражениях, используя рассмотренные
        на лекции представления в лямбда-исчислении для упорядоченных пар и алгебраических типов.
  \end{enumerate}

\item Ещё немного алгебраических типов.
  Аналогично предыдущему пункту, определите на языке высокого уровня алгебраический тип для корней 
  квадратного уравнения. Варианты значений: <<нет решений>> без параметров, <<одно решение>> 
  с одним параметром, <<два решения>> с двумя параметрами.
  Определите функции вычисления корней по коэффициентам квадратного уравнения и печати корней.

\item Деревья с помощью алгебраических типов.
  Определите на языке высокого уровня тип для дерева двоичного поиска, 
  варианты для узла: <<лист>> без параметров и <<ветвь>> с двумя сыновьями и целочисленным значением.
  Определите:
  \begin{enumerate}
    \item функцию печати дерева;
    \item функцию поиска значения в дереве;
    \item функцию добавления значения в дерево двоичного поиска;
    \item функцию удаления значения из дерева.
  \end{enumerate}

\item Доопределите бета-редукцию для просто типизированного лямбда-исчисления по Чёрчу.

\item Докажите теорему Чёрча-Россера для просто типизированного лямбда-исчисления по Чёрчу.

\item Докажите лемму о поднятии с лекции, а именно, что для всех $M,N \in \Lambda_{\texttt{к}}$:
  \begin{enumerate}
  \item если $M \rightarrow_\beta N$, то для любого $M' \in \Lambda_{\texttt{ч}}$, такого, что
        $|M'| = M$, найдётся такой $N' \in \Lambda_{\texttt{ч}}$, что $|N'| = N$ и $M' \rightarrow_\beta N'$;
  \item если $\Gamma \vdash M : \sigma$, то найдётся такой $M' \in \Lambda_{\texttt{ч}}$, что $\Gamma \vdash_\texttt{ч} M': \sigma$.
  \end{enumerate} 

\end{enumerate}

\section*{Домашнее задание №5: <<выразительная сила просто типизированного лямбда-исчисления, алгоритм унификации>>}

\begin{enumerate}
\item Покажите, что чёрчевский нумерал в общем случае имеет 
тип $(\alpha\rightarrow\alpha)\rightarrow(\alpha\rightarrow\alpha)$.
Имеют ли нумералы для $0$, $1$ и $2$ какие-то более общие типы?

\item Обозначим тип для целых чисел $\eta = (\alpha\rightarrow\alpha)\rightarrow(\alpha\rightarrow\alpha)$.
В данных обозначениях покажите, что операция сложения имеет тип $\eta\rightarrow\eta\rightarrow\eta$.

\item Напомним, что $\overline{m} = \lambda f.\lambda x.f^{(m)}\ x$ (чёрчевский нумерал для $m$).
Рассмотрим выражение $Power = \lambda m.\lambda n.n\ m$.
\begin{enumerate}
\item найдите тип $Power$;
\item покажите, что $Power\ \overline{m}\ \overline{n} = \overline{m^n}$, найдите тип $Power\ \overline{m}\ \overline{n}$;
\item покажите, что $\lambda x.Power\ x\ x$ не имеет типа;
\item объясните кажущееся противоречие между предыдущими пунктами: почему 
$Power\ \overline{2}\ \overline{2}$ имеет тип, а $(\lambda x.Power\ x\ x)\ \overline{2}$ не имеет типа.
\end{enumerate}

\item Докажите, что изложенный на лекции алгоритм унификации всегда завершается.
Указание: постройте оценку сложности уравнения в алгебраических термах и покажите,
что эта оценка уменьшается при каждом шаге алгоритма.

\end{enumerate}

\section*{Домашнее задание №6: <<унификация и типы, комбинаторы>>}

\begin{enumerate}
\item Выразите $\lambda f.\lambda x.f\ x$ через $S$ и $K$.
\item Докажите, что алгоритм устранения абстракций $T$ с лекции, преобразующий замкнутое лямбда-выражение в 
выражение в комбинаторах $S$ и $K$, корректен. То есть, для любого лямбда-выражения $A$: 
\begin{enumerate}
\item $T(A)$ определено и вычисляется за конечное время;
\item $T(A) =_\beta A$;
\item если $A$ замкнуто, то $T(A)$ не содержит абстракций и свободных переменных и состоит только из
применений (аппликаций) и комбинаторов $S$ и $K$.
\end{enumerate}
\item Покажите, что базис $B$, $C$, $K$, $W$ позволяет выразить любое замкнутое лямбда-выражение.
\item Постройте систему аксиом для импликационного фрагмента просто типизированного лямбда-исчисления на основе
базиса $B$, $C$, $K$, $W$.
\item Будем говорить, что тип $\sigma$ есть частный случай типа $\theta$ (и записывать это как
$\sigma \sqsubseteq \theta$), если существует такая подстановка $S$, что $\sigma = S(\theta)$.
Рассмотрим лямбда-выражение $M$, такое, что $\vdash M: \sigma$ и $\vdash M: \theta$.
\begin{enumerate}
\item Покажите, что найдётся тип $\tau$, что $\vdash M:\tau$, $\sigma\subseteq\tau$ и $\theta\subseteq\tau$.
\item Всегда ли найдётся $\tau$, что $\tau \subseteq \sigma$ и $\tau \subseteq \theta$?
\item Всегда ли выполнено либо $\theta \subseteq \sigma$, либо $\sigma \subseteq \theta$?
\item Можно ли определить решётку на типах для данного $M$ с определённым выше отношением предпорядка $(\subseteq)$?
Естественно, вам потребуется рассмотреть классы эквивалентности типов, чтобы <<склеить>> случаи 
типов, отличающихся только переименованием переменных.
Какими свойствами эта решётка будет обладать (дистрибутивность, импликативность, существование 0 и т.п.)?
\end{enumerate}
\end{enumerate}

\section*{Домашнее задание №7: <<исчисление второго порядка, система F>>}

\begin{enumerate}
\item Докажите, что введённые на лекции представления для связок соответствуют правилам для связок:

\begin{enumerate} 
\item Конъюнкция. 
Если $\varphi \& \psi \equiv \forall \alpha.(\varphi\rightarrow\psi\rightarrow\alpha)\rightarrow\alpha$,
то всегда можно доказать заключения следующих правил при доказанных посылках:

\begin{center}\begin{tabular}{lp{0.5cm}lp{0.5cm}l}
$$\infer{\Gamma\vdash\varphi\&\psi}{\Gamma\vdash\varphi\quad\Gamma\vdash\psi}$$ &&
$$\infer{\Gamma\vdash\varphi}{\Gamma\vdash\varphi\&\psi}$$ &&
$$\infer{\Gamma\vdash\psi}{\Gamma\vdash\varphi\&\psi}$$
\end{tabular}\end{center}

\item Дизъюнкция.
Если $\varphi \vee \psi \equiv \forall \alpha.(\varphi\rightarrow\alpha)\rightarrow(\psi\rightarrow\alpha)\rightarrow\alpha$,
то можно показать такие правила:
\begin{center}\begin{tabular}{lp{0.5cm}lp{0.5cm}l}
$$\infer{\Gamma\vdash\varphi\vee\psi}{\Gamma\vdash\varphi}$$ &&
$$\infer{\Gamma\vdash\varphi\vee\psi}{\Gamma\vdash\psi}$$ &&
$$\infer{\Gamma\vdash\pi}{\Gamma,\varphi\vdash\pi\quad\Gamma,\psi\vdash\pi\quad\Gamma\vdash\varphi\vee\psi}$$
\end{tabular}\end{center}

\item Квантор существования.
Если $\exists \alpha.\varphi \equiv \forall \theta.(\forall\alpha.\varphi\rightarrow\theta)\rightarrow\theta)$, то
можно показать и следующие правила:

\begin{center}\begin{tabular}{lp{1cm}l}
$$\infer{\Gamma\vdash\exists \alpha.\varphi}{\Gamma\vdash\varphi[\alpha := \theta]}$$ &&
$$\infer[(\alpha\notin FV(\Gamma,\psi))]{\Gamma\vdash\psi}{\Gamma\vdash\exists\alpha.\varphi\quad\Gamma,\varphi\vdash\psi}$$
\end{tabular}\end{center}

\end{enumerate}
\end{enumerate}

\section*{Домашнее задание №8: <<экзистенциальные типы, ранг типа>>}

\begin{enumerate}

\item Докажите, что если $\sigma \in R(1)$, то существует $\psi$ с поверхностными кванторами, что
$\psi \vdash \sigma$ и $\sigma \vdash \psi$.

\item Докажите, что если $M:\sigma$ и $\sigma \in R(1)$, то существует $\psi$ с поверхностными
кванторами и лямбда-выражения $N$, $F$ и $B$ в системе F, такие, что $N:\psi$, 
$F:\sigma\rightarrow\psi$ и $B:\psi\rightarrow\sigma$.

%\item Докажите, что реализация аналогов правил с квантором существования в системе $F$:

\item Рассмотрим абстрактный тип данных \verb!NatNum! (<<натуральное число>>), с операциями: (a) константа 0;
(б) сравнение двух значений; (в) прибавление 1; (г) печать в строку. Задайте его на языке Хаскель
с помощью экзистенциальных типов, предусмотрите три реализации (через \verb!Integer!, аксиоматику
Пеано и в виде строчек из цифр), напишите функции: (а) печати списка чисел в строку
(\verb![NatNum] -> String!); (б) умножения каждого числа в списке на два (\verb![NatNum] -> [NatNum]!);
(в) суммы списка (\verb![NatNum] -> NatNum!).

\end{enumerate}

\end{document}
